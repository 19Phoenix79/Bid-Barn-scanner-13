<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial=1.0">
    <title>Bid Barn Scanner Pro</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>üéØ Bid Barn Auction Scanner</h1>
        
        <!-- CSV Import Section -->
        <div class="import-section">
            <input type="file" id="csvFile" accept=".csv" style="display: none;">
            <button onclick="document.getElementById('csvFile').click()">
                üìÅ Import CSV
            </button>
            <span id="importStatus"></span>
        </div>
        <!-- Universal CSV uploader -->
<form id="univ-upload"
      action="/upload-csv"
      method="post"
      enctype="multipart/form-data"
      style="display:inline-block">

  <input type="hidden" name="marketplace" id="mp-field">
  <label style="cursor:pointer;background:#ff6600;color:#fff;padding:8px 12px;border-radius:4px">
    <input type="file" name="csv_file" accept=".csv" required hidden>
    <span id="mp-text">Upload CSV</span>
  </label>
</form>

<script>
const MP = {
  "bstock.com": {text:"B-Stock CSV"},
  "worldlytreasuresliquidation.com": {text:"WT CSV"},
  "directliquidation.com": {text:"Direct CSV"}
};
const host = location.hostname.replace('www.','');
document.getElementById('mp-field').value = host;
document.getElementById('mp-text').textContent = MP[host]?.text || "Upload CSV";
</script>

        <!-- Item Form -->
        <div class="form-section">
            <input type="text" id="itemId" placeholder="Item ID / Lot #">
            <input type="text" id="itemName" placeholder="Item Name">
            <textarea id="itemDesc" placeholder="Description" rows="3"></textarea>
            <input type="text" id="itemSku placeholder="SKU">
            <input type="number" id="startingBid" placeholder="Starting Bid ($)">
            
            <!-- Image Capture -->
            <div class="image-section">
                <video id="cameraFeed" style="display: none;"></video>
                <canvas id="snapshotCanvas" style="display: none;"></canvas>
                <img id="previewImage" class="preview" style="display: none;">
                
                <div class="camera-controls">
                    <button id="startCamera onclick="startCamera()">üì∏ Start Camera</button>
                    <button id="Btn" onclick="captureImage()" style="display: none;">üì∑ Capture</button>
                    <button id="uploadImage" onclickuploadImage()" style="display: none;">‚òÅÔ∏è Upload</button>
                </div>
            </div>
            
            <button onclick="addItem()">‚ûï Add Item</button>
        </div>

        <!-- Items List -->
        <div class="items-section">
            <h2>Auction Items (<span id="itemCount">0</span>)</h2>
            <button onclick="exportToWooCommerce()">üíæ Export WooCommerce CSV</button>
            <div id="itemsList"></div>
        </div>
    </div    <script src="app.js"></script>
</body>
</html>
          <label>Other Fees ($)</label>
          <input id="otherFees" type="number" step="0.01" placeholder="e.g. 300.00" />
        </div>
        <div class="row">
          <label>Notes / Truck Name</label>
          <input id="truckLabel" type="text" placeholder="e.g. WTL ‚Äì Kitchen & Bath 27 Pallets" />
        </div>
      </div>
      <div class="row gap">
        <button id="btnSaveSession" class="btn primary">Save Cost Info</button>
        <button id="btnNewSession" class="btn">Start New Session</button>
      </div>
      <div class="small">
        CPI = (Truck Cost + Shipping + Other Fees) √∑ Total Units on Manifest.<br />
        We‚Äôll recompute CPI every time you change costs or import a new manifest.
      </div>
    </section>

    <!-- Manifest Upload -->
    <section class="card">
      <h2>2. Upload Manifest CSV</h2>
      <p class="small">
        Expected columns: <b>SKU</b> and <b>Retail</b> are required. Optional: <b>Title</b>, <b>Qty</b>.<br />
        Example headers: <code>SKU,Title,Retail,Qty</code>
      </p>
      <div class="row gap">
        <button id="btnManifest" class="btn">üì• Choose Manifest CSV</button>
        <input id="manifestFile" type="file" accept=".csv" style="display:none" />
        <button id="btnClearItems" class="btn danger">üóë Clear All Items</button>
      </div>
      <div class="small">
        After import, CPI will be applied to every item. You can still tweak costs and re-export.
      </div>
    </section>

    <!-- Items Table -->
    <section class="card">
      <h2>3. Items & Photos</h2>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>SKU</th>
              <th>Title</th>
              <th>Retail</th>
              <th>Qty</th>
              <th>CPI (Cost / Item)</th>
              <th>Auction Start</th>
              <th>Photo</th>
            </tr>
          </thead>
          <tbody id="itemsBody"></tbody>
        </table>
      </div>
      <div class="small">
        CPI is shared across items. Auction Start defaults to CPI; you can override per item.<br />
        Click ‚ÄúAdd Photo‚Äù to take/upload a picture for that SKU.
      </div>
    </section>

    <!-- Export -->
    <section class="card">
      <h2>4. Export Bid Barn CSV for WooCommerce</h2>
      <p class="small">
        This creates a CSV with columns suitable for All Import / All Export.<br />
        <b>Images</b> column will contain a suggested filename (e.g. <code>123456789012.jpg</code>).<br />
        After exporting, save your photos with those filenames and upload them to WordPress.
      </p>
      <div class="row gap">
        <button id="btnExportCSV" class="btn primary">‚¨áÔ∏è Export Bid Barn CSV</button>
      </div>
    </section>
  </main>

  <div id="toast"></div>

  <footer class="top">
    <div class="small">¬© 2025 Bid Barn ‚Äì Sir Scansalot 2.0</div>
  </footer>

  <script src="./app.js"></script>
</body>
</html>
